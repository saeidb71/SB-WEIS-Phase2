MHK Turbine Applications
========================

As part of the CT-Opt project, RAFT is being expanded to also support underwater
marine hydrokinetic (MHK) turbines. Just as with floating wind turbines, RAFT
supports frequency-domain modeling of the global response and linearized controlled
rotor dynamics of a moored, floating, MHK turbine system. The initial capability
for floating MHK systems, which is still being developed, is available in `RAFT's
CT-Opt branch on GitHub <https://github.com/WISDEM/RAFT/tree/ctopt>`_.

This page provides 
information about using the under-development MHK capabilities of RAFT. Please
refer to the other pages for general usage, and then this page for specific 
usage changes needed for MHK applications.


Setting up and Running RAFT
---------------------------

Usage patterns for MHK applications are identical to those for floating wind turbine
applications. Refer to the :ref:`Usage and Workflow page<Usage and Workflow>` for more information.

The main differences for MHK applications are in how the design is set up in the input
dictionary or YAML file. Current speed, shear exponent, and heading must be entered in
the Case input section. And the rotor location must be specified beneath the seabed.


Additional Phenomena
--------------------

For MHK applications, RAFT simulates a number of additional phenomena. The features that have
been added are as follows.

- Rotor added mass
- Rotor buoyancy
- Multiple rotors with arbitrary positions and attachments
- Cavitation check
- Rotor gyroscopic reactions
- Mean current drag loads on floating structure


Input File Differences
----------------------

(This section to be updated)

There are no changes in the modeling settings.

In site characteristics, viscosity and shear exponent have been added for water to use in current loading and rotor hydrodynamic calculations:

.. code-block:: python
    :emphasize-lines: 7,8

    site:
        water_depth : 60         # [m]      uniform water depth
        rho_water   : 1025.0     # [kg/m^3] water density
        rho_air     : 1.225      # [kg/m^3] air density
        mu_air      : 1.81e-05   #          air dynamic viscosity
        shearExp_air: 0.12       #          wind shear exponent
        mu_water    : 1.00e-03   # [kg/ms]  water dynamic viscosity
        shearExp_water : 0.12    #          current shear exponent

In Load Cases, the list of case parameters has been edited and expanded to consist of the following:

 - wind_speed
 - wind_heading
 - wind_turbulence
 - turbine_status
 - turbine_heading (replaces yaw_misalign, applies to wind or water turbine)
 - wave_spectrum
 - wave_period
 - wave_height
 - wave_heading
 - current_speed (new)
 - current_heading (new)
 - current_turbulence (new)

This section lists the environmental and operating conditions of each load case to be analyzed.

The reference height of current_speed depends on whether it is a MHK or floating wind application.
If the first (or only) rotor is underwater, then the current speed refers to the hub height of the first rotor.
Otherwise, the current speed is taken to be at the water surface.

Nonzero turbine headings are not yet supported but will be in the future.

The turbine inputs have been modified in a number of ways. (To be added...)


There are no changes in the platform or mooring sections.



Example MHK Turbine Case
------------------------

A rough example MHK turbine case has been added to the designs included in RAFT.
While a proper reference design is in development, this example can be used to
demonstrate the new features. See the FOCTT_example.yaml file for more information.


The figure below is generated by RAFT and shows the calcualted system 
equilibrium state in unloaded and loaded conditions (produced using the Model.plot method).

.. image:: /images/FOCTT.png
    :align: center
    :scale: 80 %

As with FOWTs, properties like natural frequencies and mode shapes can be calculated.

The plot below show the power spectral densities of select responses calculated from
a basic load case (produced using the Model.plotResponse method).

.. image:: /images/FOCTT_response.png
    :align: center
    :scale: 50 %
   

The table below shows the corresponded response statistics:

==================  =========    ========   =========
Response channel     Average     RMS         Maximum
==================  =========    ========   =========
surge (m)            6.49e+00    5.43e-03    6.51e+00
sway (m)            -5.00e+00    1.83e-01   -5.00e+00
heave (m)           -8.03e+00    4.32e-01   -6.74e+00
roll (deg)           6.08e+00    7.80e-01    8.42e+00
pitch (deg)          4.21e+00    7.98e-03    4.23e+00
yaw (deg)            1.24e+01    2.51e-01    1.32e+01
nacelle acc. (m/s)   0.00e+00    1.98e-03    0.00e+00
tower bending (Nm)  -1.42e+06    1.10e+05    0.00e+00
rotor speed (RPM)    6.00e+00    0.00e+00    6.00e+00
blade pitch (deg)   -2.50e-01    0.00e+00
rotor power          2.77e+05
line 0 tension (N)   2.14e+05    1.07e+04    2.46e+05
line 1 tension (N)   1.35e+04    7.32e+02    1.57e+04
line 2 tension (N)   1.85e+05    5.23e+03    2.01e+05
line 3 tension (N)   1.31e+05    3.40e+03    1.42e+05
line 4 tension (N)   2.98e+04    4.39e+02    3.11e+04
line 5 tension (N)   4.56e+04    1.20e+03    4.92e+04
==================  =========    ========   =========








